{% load static %}
{% if event_detail.host %}
{% load sass_tags %}
link(href="{% sass_src 'sass/event_detail.sass' %}",rel="stylesheet",type="text/css")
link(href="{% sass_src 'sass/variable.sass' %}",rel="stylesheet",type="text/css")
#eventwindow
  #eventwindow-left
    #description
      #description-top
        #eventwindow-bg
          {% if event_detail.image %}
          #eventpic
            img.pic(src='{{ event_detail.image.url }}')
          {% else %}
          #eventpic
            p 目前沒有圖片
          {% endif %}
        #event-heading
          #event-title {{ event_detail.title }}
          #event-subtitle {{ event_detail.subtitle }}
        #event-date 活動日期
          br
          | {{ event_detail.event_date }}
      
      #event-detail {{ event_detail.detail }}
    #eventmsgregion
      p#msgtitle 留言板
      #eventmsg-board
        {% for eventmsg in event_detail.board_message.all reversed %}
        .eventmsg#eventmsg
          a(href="{% url 'profile' id=eventmsg.author.pk %}")
            img.sender(src='{{ eventmsg.author.img.url }}')
          #eventmsg-right
            #eventmsg-righttop
              a#eventmsg-sendername(href="{% url 'profile' id=eventmsg.author.pk %}") {{ eventmsg.author.full_name }}
              p#event-date {{ eventmsg.date }}
            #eventmsg-rightbottom
              p#eventmsgtext {{ eventmsg.text }}
        {% empty %}
        
        .eventmsg
          #eventmsg-right
            #eventmsg-righttop
              p#event-date 目前沒有留言喔～
        
        {% endfor %}
        
    #eventmsg-sender
      {% if request.user.is_authenticated %}
      a(href="{% url 'profile' id=request.user.userextend.pk %}")
        img#senderpic(src="{{ request.user.userextend.img.url }}")
      {% else %}
      img#senderpic
      {% endif %}
      {% if request.user.is_authenticated %}
      .comment-operate-region
        input.eventmsg-insert(type="text", name='text', placeholder="傳送訊息...")
        input.eventmsg-btn(type="button", value="送出")
        script.
          $(document).ready(function(){
            $(".eventmsg-btn").on("click", function() {
              message_handler(
              "{% url 'comment' event_detail.pk request.user.userextend.pk %}", 
              "{{ csrf_token }}");
            })
          })
      {% else %}
      a.comment-operate-region(href="{% url 'login' %}")
        input.eventmsg-insert(type="text", name='text', placeholder="傳送訊息...")
        input.eventmsg-btn(type="submit", value="送出")
      {% endif %}
      
  #eventwindow-right
    #joinevent-btn
    
    #eventoperate
      a
        img#exitbtn1(src="{% static 'file/exiticon.png' %}")
        
      a(href="{% url 'profile' id=event_detail.host.pk %}")
        img#organizer.member(src='{{ event_detail.host.img.url }}')
      #bar
      #member
        
        
        {% for participant in event_detail.participants.all %}
        a(href="{% url 'profile' id=participant.pk %}")
          img.member.participant(src='{{ participant.img.url }}')
        {% endfor %}

        {% for interested_user in event_detail.likes.all %}
        a(href="{% url 'profile' id=interested_user.pk %}")
          img.member.interested(src='{{ interested_user.img.url }}')
        {% endfor %}
      {% if request.user.is_authenticated %}
      
      {% if event_detail in request.user.userextend.event_like.all %}
      #likebutton(style="background-image: url('/static/file/like-bg-y.png')")
        button(type="image", src="{% static 'file/like-bg-n.png' %}", alt="Submit Form",name="event_id", value="{{ event_detail.id }}")
          span#like-img
      {% else %}
      #likebutton(style="background-image: url('/static/file/like-bg-n.png')")
        button(type="image", src="{% static 'file/like-bg-n.png' %}", alt="Submit Form",name="event_id", value="{{ event_detail.id }}")
          span#like-img
      {% endif %}
      script.
        $(document).ready(function(){
          $("#likebutton").on("click", function() {
            like_handler("{% url 'like' %}", "{{ csrf_token }}", "{{ event_detail.id }}");
          })
        })
      // user not authenticated 
      {% else %} 
      a.login-redirect(href="{% url 'login' %}")
      #likebutton(style="background-image: url('/static/file/like-bg-n.png')", href="{% url 'login' %}")
        form(action="", method="POST")
          button(type="image", src="{% static 'file/like-bg-n.png' %}", alt="Submit Form",name="event_id", value="{{ event_detail.id }}")
      {% endif %}
#filter1(style="display: block") 
script(src="{% static 'js/event_detail.js' %}")
{% endif %}
